# Полезные команды для работы с Linux серверами

## Выявление и анализ проблем на серверах
!!! note "Проверка места на жестких дисках"

    **Команда df -h**
    <br>
    Утилита df выводит на экран информацию в байтах, а -h указывает команде выводить размеры в килобайтах, мегабайтах, гигабайтах и других кратных величинах удобных для чтения

    **Команда du -sh /**
    <br>
    Позволяет отобразить размер конкретной директории. Для этого нужно запустить команду вида: du -sh directory_name/.
    Опция -s (от английского summarize) отображает только общее значение для каждого аргумента.
    <br> 
    Опция -h (от английского human readable) отображает значения в человекочитаемом формате, например, 70G, 215M

    **Команда df -i**  
    Позволяет получить информацию о размерах инодов файловых систем, покажет количество использованных и свободных инодов в каждой файловой системе на компьютере.
    <br>
    Инод (от англ. index node) — это особая структура данных в файловой системе, которая содержит информацию о файле или каталоге, но не самих данных файла. Простым языком инод можно описать как паспорт файла, где хранятся его метаданные.

    **Команда smartctl -a**  
    Выводит всю доступную SMART-информацию для указанного устройства, использующего стандартные (HDD) жесткие диски. Чтобы посмотреть данные для диска /dev/sda, нужно выполнить команду sudo smartctl -a /dev/sda

    **Команда cat /proc/mdstat**  
    Позволяет посмотреть инициализацию RAID-массива и его текущее состояние.
!!! note "Проверка процессора, памяти и дисков"

    **Команда iostat**  
    Используется для мониторинга и составления отчётов об активности ЦП, дискового ввода/вывода и блочных устройств.

    **Команда iotop**  
    Позволяет отслеживать и анализировать активность дискового ввода-вывода в режиме реального времени. С помощью этого инструмента можно определить, какие процессы генерируют наибольшее количество дисковых операций ввода-вывода, отследить скорость чтения и записи

    **Команда top**  
    Выводит список работающих в системе процессов и информацию о них. По умолчанию она в реальном времени сортирует их по нагрузке на процессор.  
    В верхней части выводится информация о системе, ниже — список процессов.  
    <br>
    Пробел — обновить вывод; <br>
    M — сортировка по используемой памяти; <br>
    P — сортировка по нагрузке на процессор (используется по умолчанию); <br>
    T — сортировка по времени работы процесса; <br>
    A — сортировка по максимальному потреблению различных ресурсов; <br>
    u — сортировка по имени пользователя (потребуется ввести имя пользователя); <br>
    k — завершить процесс (потребуется указать его идентификатор, PID); <br>
    n — изменить количество процессов в выводе (потребуется указать нужное количество); <br>
    c — вывести полный путь запущенного процесса (столбец COMMAND); <br>
    h — вывод справки; <br>
    q — выход из программы.

## Команда для работы с файлами в командной строке
!!! note "Управление файлами через командную строку"

    **Команда ls**
    <br>
    Вывод содержимого каталога

    **Команда ls -la**
    <br>
    Вывод содержимого каталога в форматированном виде (в т.ч. скрытые файлы)

    **Команда cd dir**
    <br>
    Перейти в каталог dir

    **Команда cd**
    <br>
    Перейти в домашний каталог

    **Команда pwd**
    <br>
    Показать текущий каталог

    **Команда mkdir dir**
    <br>
    Создать каталог dir

    **Команда rm file**
    <br>
    Удалить файл

    **Команда rm -r dir**
    <br>
    Удалить каталог dir

    **Команда rm -f file**
    <br>
    Принудительно удалить файл

    **Команда rm -rf dir**
    <br>
    Принудительно удалить каталог dir

    **Команда cp file1 file2**
    <br>
    Скопировать file1 в file2

    **Команда cp -r dir1 dir2**
    <br>
    Скопировать каталог dir1 в каталог dir2 (если каталога dir2 нет, он будет создан)

    **Команда mv file1 file2**
    <br>
    Переместить (или переименовать, если file1 и file2 находятся в одном каталоге) file1 в file2

    **Команда ln -s file link**
    <br>
    Создать симлинк link на файл file

    **Команда touch file**
    <br>
    Создать файл

    **Команда cat > file**
    <br>
    Направить стандартный ввод в file

    **Команда more file**
    <br>
    Вывод содержимого file

    **Команда head file**
    <br>
    Вывод содержимого первых 10 строк file

    **Команда tail file**
    <br>
    Вывод содержимого последних 10 строк file

    **Команда tail -f file**
    <br>
    Вывод содержимого file по мере появления, начиная с последних 10 строк файла.

## Коды ошибок и список популярных портов
!!! note ""

    | Code  | Description                |    | PORT            | USED       |
    | ----- | -------------------------- | -- | --------------- | ---------- |
    | `1xx` | Информационные коды        |    | 20              | FTP-данные |       
    | `2xx` | Успешная обработка запроса |    | 21              | FTP-сервер | 
    | `3xx` | Коды редиректов            |    | 22              | SSH        |
    | `4xx` | Ошибка клиента             |    | 23              | Telnet     |
    | `5xx` | Ошибка сервера             |    | 25 {==TCP==}    | SMTP       |
    |       |                            |    | 53 {==UDP==}    | DNS-сервер |
    |       |                            |    | 67:68 {==UDP==} | UDP        |
    |       |                            |    | 80 {==TCP==}    | HTTP       |
    |       |                            |    | 110             | POP3       |
    |       |                            |    | 143             | IMAP       |
    |       |                            |    | 443 {==TCP==}   | HTTPS      |
    |       |                            |    | 3306            | MySQL      |
    |       |                            |    | 123             | NTP        |
    |       |                            |    | 5432            | PostgreSQL |

    **Причины возникновения кодов:**

    - Error 405 - Метод не разрешен 
    - Error 408 - Время ожидания истекло
    - Error 404 - Страница не найдена
    - Error 403 - Доступ запрещен
    - Error 401 - Неавторизованный доступ
    - Error 400 - Неверный запрос
    - Error 502 - Ошибка шлюза
    - Error 500 - Внутренняя ошибка сервера
    - Error 504 - Шлюз не отвечает
    - Error 503 - Сервис недоступен

    **Описание популярных протоколов:**

    **TCP (Transmission Control Protocol)** 
    <br>
    Использует порт 80 для HTTP, порт 443 для HTTPS, порт 25 для SMTP. TCP обеспечивает надежную передачу данных, управление потоком и установление соединения между узлами.

    **UDP (User Datagram Protocol)**
    <br>
    Использует порт 53 для DNS, порт 67 и 68 для DHCP. UDP обеспечивает более быструю передачу данных без гарантии доставки и управления потоком.
    
    **Broadcast**
    <br>
    Использует широковещательный адрес для отправки сообщений всем узлам в сети. Это позволяет обеспечить доставку информации всем устройствам в сегменте сети.
    
    **ICMP (Internet Control Message Protocol)**
    <br>
    Используется для передачи контрольных сообщений и обнаружения ошибок в сети. ICMP может использоваться для отправки команды Ping и Traceroute.
    
    **Ping**
    <br>
    Использует ICMP для проверки доступности узла в сети путем отправки эхо-запроса и получения эхо-ответа.
    
    **Traceroute**
    <br>
    Использует ICMP для определения маршрута пакетов от отправителя к получателю. Traceroute показывает промежуточные узлы и время, необходимое для доставки пакета до каждого узла.
    
    **TTL (Time to Live)**
    <br>
    Используется в заголовке IP-пакета для ограничения времени жизни пакета. Каждый маршрутизатор уменьшает значение TTL на единицу, и если TTL достигает нуля, пакет уничтожается.
    
    **DHCP (Dynamic Host Configuration Protocol)**
    <br>
    Используется для автоматической настройки сетевых параметров устройствам в сети, таких как IP-адрес, шлюз по умолчанию и DNS-серверы.
    
    **ARP (Address Resolution Protocol)**
    <br>
    Используется для преобразования IP-адресов в MAC-адреса устройств в локальной сети. ARP позволяет устройствам определять MAC-адреса других устройств на сетевом уровне.
 
## Команды для работы с сетью и проведению анализа работы
???+ info "Вызов справочника help для команд"

    ```bash
    Linux/Unix: 
    man ping
    ```
    ```bash
    Windows:
    ping /?
    ```
!!! note "Trubbleshooting на стороне сети"

    **ping:** используется для проверки доступности узла в сети и измерения времени отклика (с помощью icmp протокола)
    <br>
    ```bash
    ping -c 5 google.com [Указывает количество отправляемых пакетов]
    ping -i 2 google.com [Устанавливает интервал между отправкой пакетов]
    ```

    **tracert (#Traceroute):** позволяет отследить маршрут следования пакетов к конечному узлу.
    <br>
    ```bash
    tracert -d google.com [Не разрешает имена хостов]
    tracert -w 500 google.com [Устанавливает время ожидания ответа]
    ```

    **nslookup:** позволяет получить информацию о доменном имени или IP-адресе
    <br>
    ```bash
    nslookup -type=MX google.com [Указывает тип запрашиваемой информации (например, A, MX, CNAME)]
    nslookup -query=MX google.com [Аналогичен параметру -type]
    ```

    **route -n:** выводит информацию о таблице маршрутизации.
    <br>
    ```bash
    route -n -e [Показывает расширенную информацию]
    route -n -F [Показывает только маршруты]
    ```

    **#telnet:** позволяет установить соединение с удаленным узлом по протоколу Telnet.
    <br>
    ```bash
    telnet -E google.com 80 [Включает эхо]
    telnet -a google.com 80 [Автоматически пытается войти в систему]
    ```

    **netstat:** выводит информацию о сетевых соединениях, сетевых интерфейсах и статистике сети.(наличие доступа к порту 80 с помощью команды netstat -tuln | grep :80)
    <br>
    ```bash
    netstat -t [Показывает только TCP-соединения]
    netstat -u [Показывает только UDP-соединения]
    ```

    **ipconfig (#ifconfig):**, для отображения сетевой информации (#ifconfig -a, отображение всех значений, даже выключенных)
    <br>
    ```bash
    ifconfig -a [Показывает все интерфейсы, включая неактивные]
    ifconfig -s [Показывает краткую информацию]
    ```

    **arp:** для просмотра и изменения кэша ARP.
    <br>
    ```bash
    arp -a [Показывает все записи в кэше ARP]
    arp -d <IP-адрес> [Удаляет запись из кэша ARP]
    ```
    
    **nmap:** сканирование сети, позволяет обнаружить открытые порты
    <br>
    ```bash
    nmap -sS google.com [Выполняет SYN-сканирование]
    nmap -p 80,443 google.com [Указывает порты для сканирования]
    ```
!!! note "Описание основ OSI"

    **Что такое OSI**
    <br>
    Это модель взаимодействия открытых систем, которая описывает, как данные передаются между устройствами в сети. Модель OSI состоит из семи уровней, каждый из которых выполняет определенные функции в процессе передачи данных.
    <br>

    !!! note ""
        **Физический уровень (Physical Layer):**
        <br>
            Передача битов данных по физическим средствам связи (кабели, радиоволны).
        <br>

        Примеры: Ethernet, Wi-Fi.
    !!! note ""
        **Канальный уровень (Data Link Layer):**
        <br>
            Обеспечение надежной передачи данных между двумя узлами, обнаружение и коррекция ошибок. Отвечает за передачу фреймов между соседними узлами, физическую адресацию (MAC), обнаружение ошибок.
        <br>
        
        Примеры: PPP (Point-to-Point Protocol), Ethernet (IEEE 802.3), Wi-Fi (802.11)
    !!! note ""
        **Сетевой уровень (Network Layer):**
        <br>
            Маршрутизация данных между различными сетями, определение пути передачи, логическая адресация.
        <br>
        
        Примеры: IP (Internet Protocol - IPv4/IPv6), ICMP (Internet Control Message Protocol).
    !!! note ""
        **Транспортный уровень (Transport Layer):**
        <br>
            Обеспечение надежной передачи данных между приложениями, управление потоком данных, сегментацию, надёжность (в случае TCP).
        <br>
        
        Примеры: TCP (Transmission Control Protocol), UDP (User Datagram Protocol).
    !!! note ""
        **Сеансовый уровень (Session Layer):**
        <br>
            Управление соединениями между приложениями, установление, поддержание и разрыв сеансов связи, также часто неявно включён в прикладной (например TLS-сессия).
        <br>
        
        Примеры: NetBIOS, RPC (Remote Procedure Call).
    !!! note ""
        **Представительский уровень (Presentation Layer):**
        <br>
        Преобразование данных в формат, понятный приложениям, шифрование и декодирование, в TCP/IP не выделен отдельно (частично входит в прикладной).
        <br>
        
        Примеры: ASCII, Unicode, JPEG.
    !!! note ""
        **Прикладной уровень (Application Layer):**
        <br>
            Предоставление интерфейса для взаимодействия с пользователем, управление приложениями. Отвечает за взаимодействие приложений с сетью, формирование сообщений.
        <br>
        
        Примеры: HTTP(s), FTP, SMTP, DNS