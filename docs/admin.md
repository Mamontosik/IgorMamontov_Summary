# Полезные команды для работы с Linux серверами

## Выявление и анализ проблем на серверах
!!! note "Проверка места на жестких дисках"

    **Команда df -h**
    <br>
    Утилита df выводит на экран информацию в байтах, а -h указывает команде выводить размеры в килобайтах, мегабайтах, гигабайтах и других кратных величинах удобных для чтения

    **Команда du -sh /**
    <br>
    Позволяет отобразить размер конкретной директории. Для этого нужно запустить команду вида: du -sh directory_name/.
    Опция -s (от английского summarize) отображает только общее значение для каждого аргумента.
    <br> 
    Опция -h (от английского human readable) отображает значения в человекочитаемом формате, например, 70G, 215M

    **Команда df -i**  
    Позволяет получить информацию о размерах инодов файловых систем, покажет количество использованных и свободных инодов в каждой файловой системе на компьютере.
    <br>
    Инод (от англ. index node) — это особая структура данных в файловой системе, которая содержит информацию о файле или каталоге, но не самих данных файла. Простым языком инод можно описать как паспорт файла, где хранятся его метаданные.

    **Команда smartctl -a**  
    Выводит всю доступную SMART-информацию для указанного устройства, использующего стандартные (HDD) жесткие диски. Чтобы посмотреть данные для диска /dev/sda, нужно выполнить команду sudo smartctl -a /dev/sda

    **Команда cat /proc/mdstat**  
    Позволяет посмотреть инициализацию RAID-массива и его текущее состояние.
!!! note "Проверка процессора, памяти и дисков"

    **Команда iostat**  
    Используется для мониторинга и составления отчётов об активности ЦП, дискового ввода/вывода и блочных устройств.

    **Команда iotop**  
    Позволяет отслеживать и анализировать активность дискового ввода-вывода в режиме реального времени. С помощью этого инструмента можно определить, какие процессы генерируют наибольшее количество дисковых операций ввода-вывода, отследить скорость чтения и записи

    **Команда top**  
    Выводит список работающих в системе процессов и информацию о них. По умолчанию она в реальном времени сортирует их по нагрузке на процессор.  
    В верхней части выводится информация о системе, ниже — список процессов.  
    <br>
    Пробел — обновить вывод; <br>
    M — сортировка по используемой памяти; <br>
    P — сортировка по нагрузке на процессор (используется по умолчанию); <br>
    T — сортировка по времени работы процесса; <br>
    A — сортировка по максимальному потреблению различных ресурсов; <br>
    u — сортировка по имени пользователя (потребуется ввести имя пользователя); <br>
    k — завершить процесс (потребуется указать его идентификатор, PID); <br>
    n — изменить количество процессов в выводе (потребуется указать нужное количество); <br>
    c — вывести полный путь запущенного процесса (столбец COMMAND); <br>
    h — вывод справки; <br>
    q — выход из программы.

## Команда для работы с файлами в командной строке
!!! note "Управление файлами через командную строку"

    **Команда ls**
    <br>
    Вывод содержимого каталога

    **Команда ls -la**
    <br>
    Вывод содержимого каталога в форматированном виде (в т.ч. скрытые файлы)

    **Команда cd dir**
    <br>
    Перейти в каталог dir

    **Команда cd**
    <br>
    Перейти в домашний каталог

    **Команда pwd**
    <br>
    Показать текущий каталог

    **Команда mkdir dir**
    <br>
    Создать каталог dir

    **Команда rm file**
    <br>
    Удалить файл

    **Команда rm -r dir**
    <br>
    Удалить каталог dir

    **Команда rm -f file**
    <br>
    Принудительно удалить файл

    **Команда rm -rf dir**
    <br>
    Принудительно удалить каталог dir

    **Команда cp file1 file2**
    <br>
    Скопировать file1 в file2

    **Команда cp -r dir1 dir2**
    <br>
    Скопировать каталог dir1 в каталог dir2 (если каталога dir2 нет, он будет создан)

    **Команда mv file1 file2**
    <br>
    Переместить (или переименовать, если file1 и file2 находятся в одном каталоге) file1 в file2

    **Команда ln -s file link**
    <br>
    Создать симлинк link на файл file

    **Команда touch file**
    <br>
    Создать файл

    **Команда cat > file**
    <br>
    Направить стандартный ввод в file

    **Команда more file**
    <br>
    Вывод содержимого file

    **Команда head file**
    <br>
    Вывод содержимого первых 10 строк file

    **Команда tail file**
    <br>
    Вывод содержимого последних 10 строк file

    **Команда tail -f file**
    <br>
    Вывод содержимого file по мере появления, начиная с последних 10 строк файла.

## Коды ошибок
!!! note "Группы ошибок по кодам"

    **1хх - информационные коды
    <br>
    2хх - успешная обработка запроса
    <br>
    3хх - коды редиректов
    <br>
    4хх - ошибка клиента
    <br>
    5хх - ошибка сервера**

    **Примеры:**
    <br>
    Error 405 - Метод не разрешен
    <br>
    Error 408 - Время ожидания истекло
    <br> 
    Error 404 - Страница не найдена
    <br>
    Error 403 - Доступ запрещен
    <br>
    Error 401 - Неавторизованный доступ
    <br>
    Error 400 - Неверный запрос
    <br>
    Error 502 - Ошибка шлюза
    <br>
    Error 500 - Внутренняя ошибка сервера
    <br>
    Error 504 - Шлюз не отвечает
    <br>
    Error 503 - Сервис недоступен
    <br>
 
## Команды для работы с сетью и проведению анализа работы
!!! note "Trubbleshooting на стороне сети"

    **#Ping:** используется для проверки доступности узла в сети и измерения времени отклика (с помощью icmp протокола)
    <br>

    **#Tracert (#Traceroute):** позволяет отследить маршрут следования пакетов к конечному узлу.
    <br>

    **#Nslookup:** позволяет получить информацию о доменном имени или IP-адресе
    <br>

    **#route -n:** выводит информацию о таблице маршрутизации.
    <br>

    **#telnet:** позволяет установить соединение с удаленным узлом по протоколу Telnet.
    <br>

    **#Netstat:** выводит информацию о сетевых соединениях, сетевых интерфейсах и статистике сети.(наличие доступа к порту 80 с помощью команды netstat -tuln | grep :80)
    <br>

    **#Ipconfig (#ifconfig):**, для отображения сетевой информации (#ifconfig -a, отображение всех значений, даже выключенных)
    <br>

    **#arp:** для просмотра и изменения кэша ARP.
    <br>
    
    **#nmap:** сканирование сети, позволяет обнаружить открытые порты


!!! note "Лучшие практики инструкций dockerfile"

    **Используйте `COPY` вместо `ADD`, если не нужно распаковывать архивы, явное распаковывание в RUN**
    <br>
    ``` yaml
    COPY app.tar.gz /tmp/
    RUN tar -xzf /tmp/app.tar.gz -C /app && rm /tmp/app.tar.gz
    ```
    <br>
    **Минимизируйте число `COPY` и `ADD`, чтобы уменьшить размер образа, копируем только нужные файлы**
    <br>
    ``` yaml
    COPY src/ /app/src/
    COPY requirements.txt /app/
    ```
    ``` yaml
    Добавьте .dockerignore
    .git
    node_modules
    __pycache__
    *.log
    ```
    <br>
    **Копируйте только изменяемые файлы, чтобы ускорить кэширование, сначала зависимости, потом код**
    <br>
    ``` yaml
    COPY requirements.txt /app/
    RUN pip install -r /app/requirements.txt

    COPY src/ /app/src/
    ```
    <br>
    **Не используйте `ADD` для загрузки файлов из интернета, используем RUN curl + COPY**
    <br>
    ```yaml
    RUN curl -L -o /tmp/file.tar.gz https://example.com/file.tar.gz
    COPY file.tar.gz /app/
    ```